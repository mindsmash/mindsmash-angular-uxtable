/*! 
 * mindsmash-angular-uxtable v0.3.0
 * https://github.com/mindsmash/mindsmash-angular-uxtable
 * Copyright (c) 2015 mindsmash GmbH
 * License: MIT
 */
!function(a){"use strict";function b(b,d,e){this.get=function(f,g){a.isUndefined(g)&&(g={});var h=a.merge({},e,g);return new c(b,d,f,h)}}function c(b,c,d,e){var f=this;f.getConfig=function(){return j},f.getData=function(){return n};for(var g="uxTable."+d,h=function(){var a=sessionStorage[g];return a?JSON.parse(sessionStorage[g]):{}},i=function(){sessionStorage[g]=JSON.stringify({page:j.page,pageSize:j.pageSize,orderBy:j.orderBy,columns:j.columns,filters:j.filters})},j=a.extend(a.extend({source:a.noop,columns:[],selection:[],active:null,filters:{}},e),h()),k=function(a){if(!a||0===a.indexOf(e.i18n.prefix))return a;var b=a.replace(/ /g,"");return e.i18n.prefix+b.toLowerCase()},l=0;l<j.columns.length;l++){var m=j.columns[l];j.columns[l]=a.extend({name:"",show:!0,sticky:!1,sort:!0,filter:!0,facets:!1},m),j.columns[l].name=k(j.columns[l].name),j.columns[l].sortKey=a.isString(m.sort)?m.sort:m.key}var n=[];f.load=function(){var d=j.requestConverter(j,f);j.source(d).then(function(d){c(function(){var c=j.responseConverter(d,f),e=c.meta.facets;delete c.meta.facets,a.extend(j,c.meta),f.setFacets(e),n=c.data,b.$emit("uxTable.dataChanged",n),b.$emit("uxTable.configChanged",j)})})},f.getPage=function(){return j.page},f.getPageSize=function(){return j.pageSize},f.setPage=function(a){f.setPagination(a,null)},f.firstPage=function(){f.setPagination(0,null)},f.prevPage=function(){f.setPagination(Math.max(0,j.page-1),null)},f.nextPage=function(){f.setPagination(Math.min(j.page+1,j.pageCount-1),null)},f.lastPage=function(){f.setPagination(j.pageCount-1,null)},f.setPageSize=function(a){f.setPagination(null,a)},f.setPagination=function(a,c){var d=!1;null!==a&&a>=0&&a!==j.page&&(j.page=a,d=!0),null!==c&&c>0&&c!==j.pageSize&&(j.pageSize=c,d=!0),d&&(b.$emit("uxTable.configChanged",j),i(),f.load())},f.getVisibility=function(a){for(var b=0;b<j.columns.length;b++){var c=j.columns[b];if(c.key===a)return c.show}return null},f.toggleVisibility=function(a){f.setVisibility(a,null)},f.setVisibility=function(b,c){a.isObject(b)&&(b=b.key);for(var d=0;d<j.columns.length;d++){var e=j.columns[d];if(e.key===b)return void(e.sticky||(e.show=null!==c?c:!e.show,i()))}},f.prevActive=function(){f.toggleActive(j.active-1)},f.nextActive=function(){f.toggleActive(j.active+1)},f.clearActive=function(){f.toggleActive(null)},f.toggleActive=function(a){null===a||a===j.active?j.active=null:0>a&&j.page>0?(f.prevPage(),j.active=j.pageSize-1):a>=j.pageSize&&j.page<j.pageCount-1?(f.nextPage(),j.active=0):a>=0&&a<n.length&&(j.active=a)},f.toggleSelection=function(a){f.setSelection(a,null)},f.setSelection=function(b,c){a.isObject(b)&&(b=b[j.view.selectionKey]);var d=j.selection.indexOf(b);0>d&&c!==!1?j.selection.push(b):d>=0&&c!==!0&&j.selection.splice(d,1)},f.setPageSelection=function(a){for(var b=0;b<n.length;b++){var c=n[b][j.view.selectionKey];f.setSelection(c,a)}},f.clearSelection=function(){j.selection=[],b.$emit("uxTable.configChanged",j)},f.getFilter=function(a){return j.filters[a]},f.setFilter=function(a,b){b?j.filters[a]=b:delete j.filters[a],i(),f.load()},f.clearFilter=function(a){f.setFilter(a,null)},f.clearFilters=function(){j.filters={}};var o=function(b,c){for(var d=j.facets.options[b],e=0;e<c.length;e++){var f=c[e];if(f.active=!1,a.isDefined(d))for(var g=0;g<d.terms.length;g++)if(d.terms[g].term===f.term){f.active=d.terms[g].active===!0;break}}return c};f.setFacets=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.name]={type:d.type,terms:o(d.name,d.terms)}}j.facets.options=b},f.toggleFacet=function(b,c){var d=j.facets.options[b];if(a.isDefined(d))for(var e=0;e<d.terms.length;e++){var g=d.terms[e];if(g.term===c)return g.active=!g.active,void f.load()}},f.getSorting=function(){return j.orderBy},f.setSorting=function(a,c){for(var d=0;d<j.columns.length;d++){var e=j.columns[d];if(e.sortKey===a)return void(e.sort!==!1&&(j.orderBy&&j.orderBy.key===a?j.orderBy.asc===!0?j.orderBy.asc=!1:j.orderBy.asc===!1&&delete j.orderBy:j.orderBy={key:a,asc:c!==!1},i(),b.$emit("uxTable.configChanged",j),f.load()))}},this.load()}a.module("mindsmash.uxTable",["mindsmash.hotkeys","pascalprecht.translate"]).provider("UxTableFactory",function(){var c={page:0,pageSize:10,orderBy:null,i18n:{prefix:"uxTable."},view:{ngClass:"ux-table-view table",keyboard:!0,selection:!0,selectionKey:"id",rowAction:a.noop},pagination:{ngClass:"ux-table-pagination",maxSize:5,rotate:!0,directionLinks:!0,previousText:"‹",nextText:"›",boundaryLinks:!0,firstText:"«",lastText:"»"},paginationSize:{ngClass:"ux-table-pagination-size",template:'<span>{{ conf.pageSize }}&nbsp;<span class="caret"></span></span>',closeOnBlur:!0,closeOnSelect:!1,closeOnDeselect:!1,options:[10,25,50,100]},toggle:{ngClass:"ux-table-toggle",template:'<span><span class="glyphicon glyphicon-th" aria-hidden="true"></span>&nbsp;<span class="caret"></span></span>',closeOnBlur:!0,closeOnSelect:!1,closeOnDeselect:!1},counter:{ngClass:"ux-table-counter",template:'<span translate="uxTable.tableCounter" translate-values="{ start: conf.page * conf.pageSize + 1, end: conf.page * conf.pageSize + conf.count, total: conf.countTotal }"></span>'},selectionCounter:{ngClass:"ux-table-selection-counter",template:'<span><span translate="uxTable.selectionCounter" translate-values="{ count: conf.selection.length }"></span><span ng-show="conf.selection.length"> (<a href="#" ng-click="clear()">clear</a>)</span></span>'},facets:{ngClass:"ux-table-facets",maxFacetCount:5,minFacetSize:3,options:{}},requestConverter:function(b,c){for(var d=b.orderBy,e={_page:b.page,_pageSize:b.pageSize,_orderBy:d&&d.key?d.key+(d.asc?",asc":",desc"):null},f={},g=0;g<b.columns.length;g++){var h=b.columns[g];h.facets&&(f["$"+b.columns[g].key]=[""])}for(var i in b.facets.options)if(b.facets.options.hasOwnProperty(i))for(var j=b.facets.options[i],k=0;k<j.terms.length;k++){var l=j.terms[k];l.active&&f["$"+i].push(l.term)}return a.extend(e,f,b.filters)},responseConverter:function(b,c){var d={meta:{page:b.page.number,pageSize:b.page.size,pageCount:b.page.totalPages,count:b.page.numberOfElements,countTotal:b.page.totalElements,facets:b.page.facets||[]},data:b};return a.isArray(b.sort)&&b.sort.length>0&&(d.meta.orderBy={key:b.sort[0].property,asc:b.sort[0].ascending}),d}};this.setConfig=function(a){return c=a,this},this.$get=["$rootScope","$timeout",function(a,d){return new b(a,d,c)}]}).directive("uxTableView",["$rootScope","hotkeys","ElementClickListener",function(a,b,c){return{replace:!0,restrict:"AE",templateUrl:"_uxTableView.html",scope:{api:"&"},controller:["$scope",function(a){this.api=a.api()}],link:function(d,e,f,g){var h=g.api;d.conf={},d.sortBy=h.setSorting,d.rowClick=function(a,b,c){h.toggleActive(b)};var i=function(a,b){d.conf=b},j=function(a,b){d.data=b};b.bindTo(d).add({combo:"shift+left",callback:h.firstPage}).add({combo:"left",callback:h.prevPage}).add({combo:"right",callback:h.nextPage}).add({combo:"shift+right",callback:h.lastPage}).add({combo:"space",callback:function(a){null!==d.conf.active&&(a.preventDefault(),h.toggleSelection(d.data[d.conf.active][d.conf.view.selectionKey]))}}).add({combo:"return",callback:function(a){if(null!==d.conf.active){a.preventDefault();var b=d.conf.active,c=d.data[b];d.conf.view.rowAction(c,b,h,a),d.conf.active=null}}}).add({combo:"up",callback:function(a){null!==d.conf.active&&(a.preventDefault(),h.prevActive())}}).add({combo:"down",callback:function(a){null!==d.conf.active&&(a.preventDefault(),h.nextActive())}}).add({combo:"esc",callback:function(a){null!==d.conf.active&&(a.preventDefault(),h.clearActive())}}),a.$on("uxTable.configChanged",i),a.$on("uxTable.dataChanged",j),c.register("uxTable.view",e,h.clearActive,!0),i(null,h.getConfig()),j(null,h.getData())}}}]).directive("uxTablePagination",["$rootScope","$timeout",function(a,b){return{replace:!0,restrict:"AE",templateUrl:"_uxTablePagination.html",scope:{api:"&"},controller:["$scope",function(a){var b=a.api();a.conf={},a.current={page:0},a.hasPrevious=function(b){return b=b?b:a.current.page,b>1},a.hasNext=function(b){return b=b?b:a.current.page,b<a.conf.pageCount},a.selectPage=function(c,d){c>=1&&c<=a.conf.pageCount&&b.setPage(c-1)}}],link:function(b,c,d){var e=b.api(),f=function(a,c){for(var d=[],e=a;c>=e;e++)d.push({number:e,active:b.current.page==e});return d},g=function(a){var c=1,d=a.pageCount;return d-c>a.pagination.maxSize-1&&(c=b.current.page-Math.floor((a.pagination.maxSize-1)/2)>0?b.current.page-Math.floor((a.pagination.maxSize-1)/2):1,d=c+(a.pagination.maxSize-1),d>a.pageCount&&(d=a.pageCount,c=d-(a.pagination.maxSize-1))),f(c,d)},h=function(a,c){b.conf=c,b.current.page=c.page+1,b.pages=g(c)};a.$on("uxTable.configChanged",h),h(null,e.getConfig())}}}]).directive("uxTablePaginationSize",["$rootScope","$compile","$filter",function(b,c,d){return{replace:!0,restrict:"AE",templateUrl:"_uxTablePaginationSize.html",scope:{api:"&"},link:{pre:function(e,f,g){var h=e.api();e.conf={},e.confLocal={ngModel:null,options:[],extraSettings:{dynamicTitle:!1,displayProp:"label",idProp:"id",externalIdProp:"id",enableSearch:!1,selectionLimit:1,showCheckAll:!1,showUncheckAll:!1,groupByTextProvider:a.noop,scrollable:!0,scrollableHeight:"auto",smartButtonMaxItems:1,smartButtonTextConverter:a.noop},events:{onItemSelect:function(a){h.setPagination(0,a.id)}}};var i=function(b,g){for(var h=[],i=0;i<g.paginationSize.options.length;i++){var j=g.paginationSize.options[i];h.push({id:j,label:""+j})}-1===g.paginationSize.options.indexOf(g.pageSize)&&h.push({id:g.pageSize,label:""+g.pageSize}),e.conf=g,e.confLocal.ngModel={id:g.pageSize,label:""+g.pageSize},e.confLocal.options=d("orderBy")(h,"id"),e.confLocal.extraSettings.closeOnBlur=g.paginationSize.closeOnBlur,e.confLocal.extraSettings.closeOnSelect=g.paginationSize.closeOnSelect,e.confLocal.extraSettings.closeOnDeselect=g.paginationSize.closeOnDeselect;var k=g.paginationSize.template;0!==k.indexOf("<")&&(k="<span>"+k+"</span>"),a.isString(k)&&e.confLocal.template!==k&&(f.find("button.dropdown-toggle").html(c(k)(e)),e.confLocal.template=k)};b.$on("uxTable.configChanged",i),i(null,h.getConfig())}}}}]).directive("uxTableToggle",["$rootScope","$compile",function(b,c){return{replace:!0,restrict:"AE",templateUrl:"_uxTableToggle.html",scope:{api:"&"},link:{pre:function(d,e,f){var g=d.api();d.conf={},d.confLocal={ngModel:[],options:[],extraSettings:{dynamicTitle:!1,displayProp:"name",idProp:"key",externalIdProp:"key",enableSearch:!1,selectionLimit:0,showCheckAll:!1,showUncheckAll:!1,groupByTextProvider:a.noop,scrollable:!0,scrollableHeight:"auto",smartButtonMaxItems:0,smartButtonTextConverter:a.noop},events:{onItemSelect:function(a){g.setVisibility(a.key,!0)},onItemDeselect:function(a){0===d.confLocal.ngModel.length?d.confLocal.ngModel.push(a):g.setVisibility(a.key,!1)}}};var h=function(b,f){for(var g=[],h=[],i=0;i<f.columns.length;i++){var j=f.columns[i];j.sticky||(g.push({key:j.key,name:j.name}),j.show&&h.push({key:j.key}))}d.conf=f,d.confLocal.ngModel=h,d.confLocal.options=g,d.confLocal.extraSettings.closeOnBlur=f.toggle.closeOnBlur,d.confLocal.extraSettings.closeOnSelect=f.toggle.closeOnSelect,d.confLocal.extraSettings.closeOnDeselect=f.toggle.closeOnDeselect;var k=f.toggle.template;0!==k.indexOf("<")&&(k="<span>"+k+"</span>"),a.isString(k)&&d.confLocal.template!==k&&(e.find("button.dropdown-toggle").html(c(k)(d)),d.confLocal.template=k)};b.$on("uxTable.configChanged",h),h(null,g.getConfig())}}}}]).directive("uxTableCounter",["$rootScope","$compile",function(b,c){return{replace:!0,restrict:"AE",templateUrl:"_uxTableCounter.html",scope:{api:"&"},link:function(d,e,f){var g=d.api();d.conf={},d.confLocal={};var h=function(b,f){d.conf=f;var g=f.counter.template;0!==g.indexOf("<")&&(g="<span>"+g+"</span>"),a.isString(g)&&d.confLocal.template!==g&&(e.html(c(g)(d)),d.confLocal.template=g)};b.$on("uxTable.configChanged",h),h(null,g.getConfig())}}}]).directive("uxTableSelectionCounter",["$rootScope","$compile",function(b,c){return{replace:!0,restrict:"AE",templateUrl:"_uxTableSelectionCounter.html",scope:{api:"&"},link:function(d,e,f){var g=d.api();d.conf={},d.confLocal={};var h=function(b,f){d.conf=f;var g=f.selectionCounter.template;0!==g.indexOf("<")&&(g="<span>"+g+"</span>"),a.isString(g)&&d.confLocal.template!==g&&(e.html(c(g)(d)),d.confLocal.template=g)};d.clear=function(){g.clearSelection()},b.$on("uxTable.configChanged",h),h(null,g.getConfig())}}}]).directive("uxTableFacets",["$rootScope",function(a){return{replace:!0,restrict:"AE",templateUrl:"_uxTableFacets.html",scope:{api:"&"},link:function(b,c,d){var e=b.api();b.conf={};var f=function(a,c){b.conf=c};b.getFilter=function(a){return b.conf.filters[a]},b.setFilter=function(a,b){e.setFilter(a,b)},b.toggleFacet=function(a,b){e.toggleFacet(a,b)},a.$on("uxTable.configChanged",f),f(null,e.getConfig())}}}]).directive("uxTableCell",["$compile",function(b){return{scope:!1,require:"^uxTableView",link:function(c,d,e){var f=c.column.template;a.isString(f)&&d.html(b(f)(c))}}}]).directive("uxTableSelection",["$timeout",function(a){return{replace:!0,require:"^uxTableView",scope:{data:"=",selection:"=",selectionKey:"="},link:function(b,c,d,e){var f=e.api,g=function(a,d){if(a!==d){for(var e=0,f=0;f<b.data.length;f++)-1!==b.selection.indexOf(b.data[f][b.selectionKey])&&(e+=1);switch(e){case 0:c.prop("checked",!1).prop("indeterminate",!1);break;case b.data.length:c.prop("checked",!0).prop("indeterminate",!1);break;default:c.prop("checked",!1).prop("indeterminate",!0)}}};b.$watch("data",g,!0),b.$watch("selection",g,!0),c.bind("change",function(){a(function(){c.prop("checked")?f.setPageSelection(!0):f.setPageSelection(!1)})})}}}]).factory("ElementClickListener",["$window","$timeout",function(b,c){var d={},e=a.element(b),f=function(a,b){for(;0!==b.length;){if(b[0]===a[0])return!0;b=b.parent()}return!1};return e.on("click",function(b){for(var e in d)if(d.hasOwnProperty(e)){var g=d[e],h=g.element,i=a.element(b.target);f(h,i)?g.inverse||c(g.callback):g.inverse&&c(g.callback)}}),{register:function(b,c,e,f){d[b]={element:a.element(c),callback:e,inverse:f}},deregister:function(a){delete d[a]}}}])}(angular),angular.module("mindsmash.uxTable").run(["$templateCache",function(a){"use strict";a.put("_uxTableCounter.html",'<div ng-class="conf.counter.ngClass" ng-show="conf.countTotal"></div>'),a.put("_uxTableFacets.html",'<div ng-class="conf.facets.ngClass"><ul ng-repeat="column in conf.columns" class="list-group" ng-if="column.filter || column.facets" ng-show="column.show"><li class="list-group-item list-group-input" ng-class="{ active: !!columnFilter }" ng-if="column.filter"><span class="badge pointer pull-right" ng-click="columnFilter = \'\'; setFilter(column.key, \'\')">&times;</span> <input type="text" class="form-control input-sm" translate translate-attr-placeholder="{{ column.name }}" ng-init="columnFilter = getFilter(column.key)" ng-model="columnFilter" ng-model-options="{ updateOn: \'default blur\', debounce: {\'default\': 500, \'blur\': 0} }" ng-change="setFilter(column.key, columnFilter)"></li><li ng-repeat="term in conf.facets.options[column.key].terms.slice(0, conf.facets.maxFacetCount)" ng-if="column.facets && term.count >= conf.facets.minFacetSize" class="list-group-item pointer" ng-class="{ active: term.active }" ng-click="toggleFacet(column.key, term.term)"><span class="badge pull-right">{{ term.count }}</span>{{ term.term }}</li></ul></div>'),a.put("_uxTablePagination.html",'<div ng-class="conf.pagination.ngClass" ng-show="conf.pageCount > 1"><ul class="pagination"><li ng-class="{disabled: (!hasPrevious() || !conf.pagination.boundaryLinks)}" class="pagination-first"><a href ng-click="selectPage(1, $event)">{{conf.pagination.firstText}}</a></li><li ng-class="{disabled: (!hasPrevious() || !conf.pagination.directionLinks)}" class="pagination-prev"><a href ng-click="selectPage(current.page - 1, $event)">{{conf.pagination.previousText}}</a></li><li ng-class="{active: page.number == current.page}" ng-repeat="page in pages" class="pagination-page"><a href ng-click="selectPage(page.number, $event)">{{page.number}}</a></li><li ng-class="{disabled: (!hasNext() || !conf.pagination.directionLinks)}" class="pagination-next"><a href ng-click="selectPage(current.page + 1, $event)">{{conf.pagination.nextText}}</a></li><li ng-class="{disabled: (!hasNext() || !conf.pagination.boundaryLinks)}" class="pagination-last"><a href ng-click="selectPage(conf.pageCount, $event)">{{conf.pagination.lastText}}</a></li></ul></div>'),a.put("_uxTablePaginationSize.html",'<div ng-class="conf.paginationSize.ngClass"><ng-dropdown-multiselect selected-model="confLocal.ngModel" options="confLocal.options" extra-settings="confLocal.extraSettings" events="confLocal.events"></ng-dropdown-multiselect></div>'),a.put("_uxTableSelectionCounter.html",'<div ng-class="conf.selectionCounter.ngClass" ng-show="conf.countTotal"></div>'),a.put("_uxTableToggle.html",'<div ng-class="conf.toggle.ngClass"><ng-dropdown-multiselect selected-model="confLocal.ngModel" options="confLocal.options" extra-settings="confLocal.extraSettings" events="confLocal.events" checkboxes="true"></ng-dropdown-multiselect></div>'),a.put("_uxTableView.html",'<table ng-class="conf.view.ngClass"><thead><tr><th ng-if="conf.view.selection" class="ux-table-selection"><input type="checkbox" ux-table-selection data="data" selection="conf.selection" selection-key="conf.view.selectionKey"></th><th ng-repeat="column in conf.columns | filter : { show: true }" ng-click="sortBy(column.sortKey)" ng-class="{ \'sort\': column.sort !== false, \'sort-asc\': conf.orderBy.key === column.sortKey && conf.orderBy.asc === true, \'sort-desc\': conf.orderBy.key === column.sortKey && conf.orderBy.asc === false }" translate="{{ column.name }}"></th></tr></thead><tbody><tr ng-if="!data.length"><td colspan="{{ 1 + (conf.columns | filter : { show: true }).length }}" class="ux-table-empty" translate="uxTable.empty"></td></tr><tr><tr ng-repeat="row in data" ng-click="rowClick(row, $index, $event)" ng-class="{ active: conf.active === $index }"><td ng-if="conf.view.selection" class="ux-table-selection"><input type="checkbox" checklist-model="conf.selection" checklist-value="row[conf.view.selectionKey]" class="ux-table-selection-input"></td><td ng-repeat="column in conf.columns | filter : { show: true }" ux-table-cell>{{ row[column.key] }}</td></tr></tbody></table>')}]);